<script type="module">
  import {
    web3Enable,
    web3Accounts,
    web3FromAddress,
  } from "https://esm.sh/@polkadot/extension-dapp";

  const connectBtn = document.getElementById("connectBtn");
  const msg = document.getElementById("message");
  const connectScreen = document.getElementById("connect-screen");
  const welcome = document.getElementById("welcome");

  connectBtn.addEventListener("click", async () => {
    msg.textContent = "Connecting...";
    console.log("üîó Starting wallet connection...");

    try {
      // Request permission to connect to wallet extensions
      const extensions = await web3Enable("FabricPop");
      console.log("Extensions found:", extensions);

      if (!extensions || extensions.length === 0) {
        msg.innerHTML = `
          ‚ùå No Polkadot wallet extension detected.<br>
          Please install <a href='https://talisman.xyz' target='_blank'>Talisman</a> 
          or <a href='https://polkadot.js.org/extension/' target='_blank'>Polkadot.js</a>.
        `;
        return;
      }

      // Get available accounts from the wallet
      const accounts = await web3Accounts();
      console.log("Accounts found:", accounts);

      if (accounts.length === 0) {
        msg.textContent = "No accounts found in wallet.";
        return;
      }

      const account = accounts[0];
      msg.textContent = `‚úÖ Connected: ${account.address}`;
      console.log("Connected to:", account.address);

      // Get the signer for transactions
      const injector = await web3FromAddress(account.address);
      console.log("Signer injector:", injector);

      // Show welcome screen after small delay
      setTimeout(() => {
        connectScreen.style.display = "none";
        welcome.style.display = "block";
      }, 800);
    } catch (err) {
      console.error("‚ö†Ô∏è Connection error:", err);
      msg.textContent = "‚ö†Ô∏è Failed to connect wallet. Check console for details.";
    }
  });
</script>
